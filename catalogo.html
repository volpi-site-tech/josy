<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Catálogo — VOLPI Negócios Imobiliários</title>
<link rel="icon" href="logo.svg">
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
<header class="header">
  <div class="brand"><img src="logo.svg" alt="logo" style="height:56px"></div>
  <nav class="nav">
    <a href="index.html">Home</a>
    <a href="sobre.html">Sobre</a>
    <a href="catalogo.html">Catálogo</a>
    <a href="contato.html">Contato</a>
  </nav>
</header>

<section style="padding:28px 0">
  <h1>Catálogo de Imóveis</h1>
  <p class="lead-strap">Gerencie anúncios de forma simples. Armazene no navegador ou exporte como JSON.</p>

  <div style="display:flex;gap:12px;margin-bottom:12px">
    <button id="newBtn" class="btn btn-primary">Novo Imóvel</button>
    <button id="exportBtn" class="btn btn-outline">Exportar JSON</button>
  </div>

  <div id="grid" class="listings grid"></div>

  <!-- modal -->
  <div id="modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center">
    <div style="background:white;padding:20px;border-radius:10px;max-width:720px;width:95%">
      <h3 id="mTitle">Novo imóvel</h3>
      <form id="form">
        <label>Nome<br><input name="name"></label><br>
        <label>Descrição<br><textarea name="description"></textarea></label><br>
        <label>Características (vírgula separados)<br><input name="features"></label><br>
        <label>Valor (R$)<br><input name="price" type="number" step="0.01"></label><br>
        <label>Fotos<br><input name="media" type="file" accept="image/*" multiple></label><br>
        <div style="margin-top:10px">
          <button type="submit" class="btn btn-primary">Salvar</button>
          <button type="button" id="cancel" class="btn btn-outline">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

</section>

<footer class="footer">
  <p>&copy; VOLPI Negócios Imobiliários</p>
</footer>
</div>
<script src="app.js"></script>
<script>
(function(){
  const LS='volpi_catalog_v2';
  let listings = JSON.parse(localStorage.getItem(LS) || '[]');
  const grid = document.getElementById('grid');
  const modal = document.getElementById('modal');
  const form = document.getElementById('form');
  const newBtn = document.getElementById('newBtn');
  const cancel = document.getElementById('cancel');

  function render(){
    grid.innerHTML='';
    if(listings.length===0){ grid.innerHTML='<p class="muted">Nenhum imóvel cadastrado.</p>'; return; }
    listings.forEach((it,idx)=>{
      const el = document.createElement('div');
      el.className='card';
      el.innerHTML = `<img src="${it.media?it.media[0]:'images/destaque_home.jpg'}" style="width:100%;height:160px;object-fit:cover;border-radius:8px">
        <h4>${it.name||'Sem nome'}</h4>
        <div class="meta">${(it.features||[]).join(' · ')}</div>
        <div class="meta">${it.price? 'R$ '+Number(it.price).toLocaleString('pt-BR'):'Sob consulta'}</div>
        <p class="muted">${(it.description||'').slice(0,140)}</p>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button data-edit="${idx}" class="btn">Editar</button>
          <button data-delete="${idx}" class="btn btn-outline">Excluir</button>
        </div>`;
      grid.appendChild(el);
    });
  }

  newBtn.addEventListener('click', ()=>{ modal.style.display='flex'; document.getElementById('mTitle').innerText='Novo imóvel'; form.reset(); });

  cancel.addEventListener('click', ()=>{ modal.style.display='none'; });

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const fd = new FormData(form);
    const name = fd.get('name');
    const description = fd.get('description');
    const features = fd.get('features')? fd.get('features').split(',').map(s=>s.trim()):[];
    const price = fd.get('price');
    const files = fd.getAll('media');
    const media=[];
    for(const f of files){
      if(!f || f.size===0) continue;
      media.push(await toBase64(f));
    }
    listings.unshift({name,description,features,price,media});
    localStorage.setItem(LS, JSON.stringify(listings));
    modal.style.display='none';
    render();
  });

  grid.addEventListener('click',(e)=>{
    const ed = e.target.dataset.edit;
    const del = e.target.dataset.delete;
    if(ed!==undefined){ const it=listings[ed]; modal.style.display='flex'; document.getElementById('mTitle').innerText='Editar imóvel'; form.name.value=it.name; form.description.value=it.description; form.features.value=(it.features||[]).join(', '); form.price.value=it.price||''; listings.splice(ed,1); localStorage.setItem(LS, JSON.stringify(listings)); render(); }
    if(del!==undefined){ if(confirm('Excluir?')){ listings.splice(del,1); localStorage.setItem(LS, JSON.stringify(listings)); render(); } }
  });

  function toBase64(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=()=>rej(); r.readAsDataURL(file); }); }

  render();
})();
</script>
</body>
</html>
